package service.vulnerabilities_aggregation.Preprocessing.CreatingEntities;

import entities.programEntities.RSSAlert;
import entities.programEntities.miningEntities.PreprocessingEntity;
import org.jsoup.Jsoup;

import java.util.ArrayList;

/**
 * Created by Eugen on 23.09.2017.
 */
public class RSSPreprocessing{

    ArrayList<RSSAlert> rssAlerts;
    ArrayList<PreprocessingEntity> preprocessingEntities = new ArrayList<PreprocessingEntity>();

    public RSSPreprocessing(ArrayList<RSSAlert> alerts){
        this.rssAlerts = alerts;
    }

    public ArrayList<PreprocessingEntity> getPreprocessingEntities() {
        return preprocessingEntities;
    }

    public void createRSSFeedEntitiesPreprocessing(){
        for(RSSAlert rssAlert : rssAlerts){

            PreprocessingEntity preprocessingEntity = new PreprocessingEntity();

            if(rssAlert.getOrigin().equals("US-CERT Alerts")){

                preprocessingEntity.setSource("US-CERT Alerts");
                preprocessingEntity.setOriginalMessage(rssAlert.getDescription());
                preprocessingEntity.setShortDescription(rssAlert.getTitle());

                String description = rssAlert.getDescription();
                String longDesc = description.substring(description.indexOf("<h3>Description")+23, description.indexOf("<h3>Impact"));

                preprocessingEntity.setLongDescription(html2text(longDesc));

               // System.out.println(preprocessingEntity);

                preprocessingEntities.add(preprocessingEntity);
            }

            if(rssAlert.getOrigin().equals("Cisco Security Advisory")){

                preprocessingEntity.setSource("US-CERT Alerts");
                preprocessingEntity.setOriginalMessage(rssAlert.getDescription());
                preprocessingEntity.setShortDescription(rssAlert.getTitle());
                preprocessingEntity.setLongDescription(html2text(rssAlert.getDescription()));

                preprocessingEntities.add(preprocessingEntity);
            }

            if(rssAlert.getOrigin().equals("Bugtraq")){

                preprocessingEntity.setSource("Bugtraq");
                preprocessingEntity.setOriginalMessage(rssAlert.getDescription());
                preprocessingEntity.setShortDescription(rssAlert.getTitle());
                preprocessingEntity.setLongDescription(html2text(rssAlert.getDescription()));

                preprocessingEntities.add(preprocessingEntity);
            }

        }

    }

    public static String html2text(String html) {
        return Jsoup.parse(html).text();
    }

}
