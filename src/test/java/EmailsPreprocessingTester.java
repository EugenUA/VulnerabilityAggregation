import entities.programEntities.AggregationEntities.Email;
import org.junit.Before;
import org.junit.Test;
import service.ServiceException;
import service.vulnerabilities_aggregation.Preprocessing.EmailsPreprocessing;

import java.util.ArrayList;

public class EmailsPreprocessingTester {

    public Email gentooEmail = new Email();
    public Email gentooEmail2 = new Email();

    @Before
    public void setUp() throws Exception {
        gentooEmail.setFrom("security@gentoo.org");
        gentooEmail.setContent("- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n" +
                "Gentoo Linux Security Advisory                           GLSA 201709-11\n" +
                "- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n" +
                "                                           https://security.gentoo.org/\n" +
                "- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n" +
                "\n" +
                " Severity: High\n" +
                "    Title: GIMPS: Root privilege escalation\n" +
                "     Date: September 17, 2017\n" +
                "     Bugs: #603408\n" +
                "       ID: 201709-11\n" +
                "\n" +
                "- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n" +
                "\n" +
                "Synopsis\n" +
                "========\n" +
                "\n" +
                "Gentoo's GIMPS ebuilds are vulnerable to privilege escalation due to\n" +
                "improper permissions. A local attacker could use it to gain root\n" +
                "privileges.\n" +
                "\n" +
                "Background\n" +
                "==========\n" +
                "\n" +
                "GIMPS, the Great Internet Mersenne Prime Search, is a software capable\n" +
                "of find Mersenne Primes, which are used in cryptography. GIMPS is also\n" +
                "used for hardware testing.\n" +
                "\n" +
                "Affected packages\n" +
                "=================\n" +
                "\n" +
                "    -------------------------------------------------------------------\n" +
                "     Package              /     Vulnerable     /            Unaffected\n" +
                "    -------------------------------------------------------------------\n" +
                "  1  sci-mathematics/gimps       < 28.10-r1               >= 28.10-r1\n" +
                "\n" +
                "Description\n" +
                "===========\n" +
                "\n" +
                "It was discovered that Gentoo’s default GIMPS installation suffered\n" +
                "from a privilege escalation vulnerability in the init script. This\n" +
                "script calls an unsafe \"chown -R\" command in checkconfig() function.\n" +
                "\n" +
                "Impact\n" +
                "======\n" +
                "\n" +
                "A local attacker who does not belong to the root group, but has the\n" +
                "ability to modify the /var/lib/gimps directory can escalate privileges\n" +
                "to the root group.\n" +
                "\n" +
                "Workaround\n" +
                "==========\n" +
                "\n" +
                "There is no known workaround at this time.\n" +
                "\n" +
                "Resolution\n" +
                "==========\n" +
                "\n" +
                "All GIMPS users should upgrade to the latest version:\n" +
                "\n" +
                "  # emerge --sync\n" +
                "  # emerge --ask --oneshot --verbose \">=sci-mathematics/gimps-28.10-r1\"\n" +
                "\n" +
                "References\n" +
                "==========\n" +
                "\n" +
                "[ 1 ] CVE-2017-14484\n" +
                "      https://nvd.nist.gov/vuln/detail/CVE-2017-14484\n" +
                "\n" +
                "Availability\n" +
                "============\n" +
                "\n" +
                "This GLSA and any updates to it are available for viewing at\n" +
                "the Gentoo Security Website:\n" +
                "\n" +
                " https://security.gentoo.org/glsa/201709-11\n" +
                "\n" +
                "Concerns?\n" +
                "=========\n" +
                "\n" +
                "Security is a primary focus of Gentoo Linux and ensuring the\n" +
                "confidentiality and security of our users' machines is of utmost\n" +
                "importance to us. Any security concerns should be addressed to\n" +
                "security@gentoo.org or alternatively, you may file a bug at\n" +
                "https://bugs.gentoo.org.\n" +
                "\n" +
                "License\n" +
                "=======\n" +
                "\n" +
                "Copyright 2017 Gentoo Foundation, Inc; referenced text\n" +
                "belongs to its owner(s).\n" +
                "\n" +
                "The contents of this document are licensed under the\n" +
                "Creative Commons - Attribution / Share Alike license.\n" +
                "\n" +
                "http://creativecommons.org/licenses/by-sa/2.5");

        gentooEmail.setSubject("[gentoo-announce] [ GLSA 201709-11 ] GIMPS: Root privilege escalation");

        gentooEmail2.setFrom("security@gentoo.org");
        gentooEmail2.setSubject("[gentoo-announce] [ GLSA 201709-14 ] cURL: Multiple vulnerabilities");
        gentooEmail2.setContent("- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n" +
                "Gentoo Linux Security Advisory                           GLSA 201709-14\n" +
                "- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n" +
                "                                           https://security.gentoo.org/\n" +
                "- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n" +
                "\n" +
                " Severity: Normal\n" +
                "    Title: cURL: Multiple vulnerabilities\n" +
                "     Date: September 17, 2017\n" +
                "     Bugs: #615870, #615994, #626776\n" +
                "       ID: 201709-14\n" +
                "\n" +
                "- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n" +
                "\n" +
                "Synopsis\n" +
                "========\n" +
                "\n" +
                "Multiple vulnerabilities have been found in cURL, the worst of which\n" +
                "may allow attackers to bypass intended restrictions.\n" +
                "\n" +
                "Background\n" +
                "==========\n" +
                "\n" +
                "cURL is a tool and libcurl is a library for transferring data with URL\n" +
                "syntax.\n" +
                "\n" +
                "Affected packages\n" +
                "=================\n" +
                "\n" +
                "    -------------------------------------------------------------------\n" +
                "     Package              /     Vulnerable     /            Unaffected\n" +
                "    -------------------------------------------------------------------\n" +
                "  1  net-misc/curl                < 7.55.1                  >= 7.55.1\n" +
                "\n" +
                "Description\n" +
                "===========\n" +
                "\n" +
                "Multiple vulnerabilities have been discovered in cURL. Please review\n" +
                "the CVE identifiers referenced below for details.\n" +
                "\n" +
                "Impact\n" +
                "======\n" +
                "\n" +
                "Remote attackers could cause a Denial of Service condition, obtain\n" +
                "sensitive information, or bypass intended restrictions for TLS\n" +
                "sessions.\n" +
                "\n" +
                "Workaround\n" +
                "==========\n" +
                "\n" +
                "There is no known workaround at this time.\n" +
                "\n" +
                "Resolution\n" +
                "==========\n" +
                "\n" +
                "All cURL users should upgrade to the latest version:\n" +
                "\n" +
                "  # emerge --sync\n" +
                "  # emerge --ask --oneshot --verbose \">=net-misc/curl-7.55.1\"\n" +
                "\n" +
                "References\n" +
                "==========\n" +
                "\n" +
                "[ 1 ] CVE-2017-1000099\n" +
                "      http://nvd.nist.gov/nvd.cfm?cvename=CVE-2017-1000099\n" +
                "[ 2 ] CVE-2017-1000100\n" +
                "      http://nvd.nist.gov/nvd.cfm?cvename=CVE-2017-1000100\n" +
                "[ 3 ] CVE-2017-1000101\n" +
                "      http://nvd.nist.gov/nvd.cfm?cvename=CVE-2017-1000101\n" +
                "[ 4 ] CVE-2017-7407\n" +
                "      http://nvd.nist.gov/nvd.cfm?cvename=CVE-2017-7407\n" +
                "[ 5 ] CVE-2017-7468\n" +
                "      http://nvd.nist.gov/nvd.cfm?cvename=CVE-2017-7468\n" +
                "\n" +
                "Availability\n" +
                "============\n" +
                "\n" +
                "This GLSA and any updates to it are available for viewing at\n" +
                "the Gentoo Security Website:\n" +
                "\n" +
                " https://security.gentoo.org/glsa/201709-14\n" +
                "\n" +
                "Concerns?\n" +
                "=========\n" +
                "\n" +
                "Security is a primary focus of Gentoo Linux and ensuring the\n" +
                "confidentiality and security of our users' machines is of utmost\n" +
                "importance to us. Any security concerns should be addressed to\n" +
                "security@gentoo.org or alternatively, you may file a bug at\n" +
                "https://bugs.gentoo.org.\n" +
                "\n" +
                "License\n" +
                "=======\n" +
                "\n" +
                "Copyright 2017 Gentoo Foundation, Inc; referenced text\n" +
                "belongs to its owner(s).\n" +
                "\n" +
                "The contents of this document are licensed under the\n" +
                "Creative Commons - Attribution / Share Alike license.\n" +
                "\n" +
                "http://creativecommons.org/licenses/by-sa/2.5");
    }

    @Test
    public void preprocessingGentooAdvisoriesTest(){
        ArrayList<Email> emails = new ArrayList<Email>();
        emails.add(gentooEmail);
        emails.add(gentooEmail2);
        EmailsPreprocessing emailsPreprocessing = new EmailsPreprocessing(emails);
        try {
            emailsPreprocessing.mainPreprocessing();
        } catch (ServiceException e){

        }
    }
}
