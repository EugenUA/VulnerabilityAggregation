import entities.programEntities.miningEntities.PreprocessingEntity;
import org.junit.Before;
import org.junit.Test;
import service.vulnerabilities_aggregation.Classification.Classification;
import service.vulnerabilities_aggregation.Preprocessing.Preprocessing;

import java.util.ArrayList;

public class TextMiningTest {

    private PreprocessingEntity emailEntity = new PreprocessingEntity();
    private PreprocessingEntity rssEntity = new PreprocessingEntity();
    private PreprocessingEntity htmlEntity = new PreprocessingEntity();

    private ArrayList<PreprocessingEntity> emailEntityArrayList;
    private ArrayList<PreprocessingEntity> rssEntityArrayList;
    private ArrayList<PreprocessingEntity> htmlEntityArrayList;

    private ArrayList<PreprocessingEntity> preprocessingEntities;

    private Preprocessing preprocessing;

    private Classification classification;

    @Before
    public void setUp() throws Exception{

        /* EMAIL */

        emailEntity.setShortDescription("Gentoo's GIMPS ebuilds are vulnerable to privilege escalation due to\n" +
                "improper permissions. A local attacker could use it to gain root\n" +
                "privileges.");
        emailEntity.setLongDescription("It was discovered that Gentoo�s default GIMPS installation suffered\n" +
                "from a privilege escalation vulnerability in the init script. This\n" +
                "script calls an unsafe \"chown -R\" command in checkconfig() function.' ");
        emailEntity.setOriginalMessage("- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n" +
                "Gentoo Linux Security Advisory                           GLSA 201709-11\n" +
                "- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n" +
                "                                           https://security.gentoo.org/\n" +
                "- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n" +
                "\n" +
                " Severity: High\n" +
                "    Title: GIMPS: Root privilege escalation\n" +
                "     Date: September 17, 2017\n" +
                "     Bugs: #603408\n" +
                "       ID: 201709-11\n" +
                "\n" +
                "- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n" +
                "\n" +
                "Synopsis\n" +
                "========\n" +
                "\n" +
                "Gentoo's GIMPS ebuilds are vulnerable to privilege escalation due to\n" +
                "improper permissions. A local attacker could use it to gain root\n" +
                "privileges.\n" +
                "\n" +
                "Background\n" +
                "==========\n" +
                "\n" +
                "GIMPS, the Great Internet Mersenne Prime Search, is a software capable\n" +
                "of find Mersenne Primes, which are used in cryptography. GIMPS is also\n" +
                "used for hardware testing.\n" +
                "\n" +
                "Affected packages\n" +
                "=================\n" +
                "\n" +
                "    -------------------------------------------------------------------\n" +
                "     Package              /     Vulnerable     /            Unaffected\n" +
                "    -------------------------------------------------------------------\n" +
                "  1  sci-mathematics/gimps       < 28.10-r1               >= 28.10-r1\n" +
                "\n" +
                "Description\n" +
                "===========\n" +
                "\n" +
                "It was discovered that Gentoo�s default GIMPS installation suffered\n" +
                "from a privilege escalation vulnerability in the init script. This\n" +
                "script calls an unsafe \"chown -R\" command in checkconfig() function.\n" +
                "\n" +
                "Impact\n" +
                "======\n" +
                "\n" +
                "A local attacker who does not belong to the root group, but has the\n" +
                "ability to modify the /var/lib/gimps directory can escalate privileges\n" +
                "to the root group.\n" +
                "\n" +
                "Workaround\n" +
                "==========\n" +
                "\n" +
                "There is no known workaround at this time.\n" +
                "\n" +
                "Resolution\n" +
                "==========\n" +
                "\n" +
                "All GIMPS users should upgrade to the latest version:\n" +
                "\n" +
                "  # emerge --sync\n" +
                "  # emerge --ask --oneshot --verbose \">=sci-mathematics/gimps-28.10-r1\"\n" +
                "\n" +
                "References\n" +
                "==========\n" +
                "\n" +
                "[ 1 ] CVE-2017-14484\n" +
                "      https://nvd.nist.gov/vuln/detail/CVE-2017-14484\n" +
                "\n" +
                "Availability\n" +
                "============\n" +
                "\n" +
                "This GLSA and any updates to it are available for viewing at\n" +
                "the Gentoo Security Website:\n" +
                "\n" +
                " https://security.gentoo.org/glsa/201709-11\n" +
                "\n" +
                "Concerns?\n" +
                "=========\n" +
                "\n" +
                "Security is a primary focus of Gentoo Linux and ensuring the\n" +
                "confidentiality and security of our users' machines is of utmost\n" +
                "importance to us. Any security concerns should be addressed to\n" +
                "security@gentoo.org or alternatively, you may file a bug at\n" +
                "https://bugs.gentoo.org.\n" +
                "\n" +
                "License\n" +
                "=======\n" +
                "\n" +
                "Copyright 2017 Gentoo Foundation, Inc; referenced text\n" +
                "belongs to its owner(s).\n" +
                "\n" +
                "The contents of this document are licensed under the\n" +
                "Creative Commons - Attribution / Share Alike license.\n" +
                "\n" +
                "http://creativecommons.org/licenses/by-sa/2.5'}");
        emailEntity.setSource("From email");
        /* RSS */

        rssEntity.setShortDescription("TA17-318B: HIDDEN COBRA – North Korean Trojan: Volgmer");
        rssEntity.setLongDescription("Volgmer is a backdoor Trojan designed to provide covert access to a compromised system. " +
                "Since at least 2013, HIDDEN COBRA actors have been observed using Volgmer malware in the wild to target the" +
                        " government, financial, automotive, and media industries. It is suspected that spear phishing is the primary" +
                        " delivery mechanism for Volgmer infections; however, HIDDEN COBRA actors use a suite of custom tools, some" +
                        " of which could also be used to initially compromise a system. Therefore, it is possible that additional" +
                        " HIDDEN COBRA malware may be present on network infrastructure compromised with Volgmer The U.S. Government" +
                        " has analyzed Volgmer’s infrastructure and have identified it on systems using both dynamic and static IP" +
                        " addresses. At least 94 static IP addresses were identified, as well as dynamic IP addresses registered" +
                        " across various countries. The greatest concentrations of dynamic IPs addresses are identified below by" +
                        " approximate percentage: India (772 IPs) 25.4 percent Iran (373 IPs) 12.3 percent Pakistan (343 IPs) 11.3" +
                        " percent Saudi Arabia (182 IPs) 6 percent Taiwan (169 IPs) 5.6 percent Thailand (140 IPs) 4.6 percent Sri" +
                        " Lanka (121 IPs) 4 percent China (82 IPs, including Hong Kong (12)) 2.7 percent Vietnam (80 IPs) 2.6 percent" +
                        " Indonesia (68 IPs) 2.2 percent Russia (68 IPs) 2.2 percent Technical Details As a backdoor Trojan, Volgmer" +
                        " has several capabilities including: gathering system information, updating service registry keys," +
                        " downloading and uploading files, executing commands, terminating processes, and listing directories." +
                        " In one of the samples received for analysis, the US-CERT Code Analysis Team observed botnet controller" +
                        " functionality. Volgmer payloads have been observed in 32-bit form as either executables or dynamic-link" +
                        " library (.dll) files. The malware uses a custom binary protocol to beacon back to the command and control" +
                        " (C2) server, often via TCP port 8080 or 8088, with some payloads implementing Secure Socket Layer (SSL) " +
                        "encryption to obfuscate communications. Malicious actors commonly maintain persistence on a victim’s system" +
                        " by installing the malware-as-a-service. Volgmer queries the system and randomly selects a service in which" +
                        " to install a copy of itself. The malware then overwrites the ServiceDLL entry in the selected service's " +
                        "registry entry. In some cases, HIDDEN COBRA actors give the created service a pseudo-random name that may be" +
                        " composed of various hardcoded words. Detection and Response This alert’s IOC files provide HIDDEN COBRA" +
                        " indicators related to Volgmer. DHS and FBI recommend that network administrators review the information" +
                        " provided, identify whether any of the provided IP addresses fall within their organizations’ allocated IP" +
                        " address space, and—if found—take necessary measures to remove the malware. When reviewing network " +
                        "perimeter logs for the IP addresses, organizations may find instances of these IP addresses attempting to" +
                        " connect to their systems. Upon reviewing the traffic from these IP addresses, system owners may find some" +
                        " traffic relates to malicious activity and some traffic relates to legitimate activity. Network Signatures" +
                        " and Host-Based Rules This section contains network signatures and host-based rules that can be used to" +
                        " detect malicious activity associated with HIDDEN COBRA actors. Although created using a comprehensive" +
                        " vetting process, the possibility of false positives always remains. These signatures and rules should " +
                        "be used to supplement analysis and should not be used as a sole source of attributing this activity to" +
                        " HIDDEN COBRA actors. Network Signatures alert tcp any any -> any any " +
                        "(msg:\"Malformed_UA\"; content:\"User-Agent: Mozillar/\"; depth:500; sid:99999999;)" +
                        " ___________________________________________________________________________________________________ YARA" +
                        " Rules rule volgmer { meta:     description = \"Malformed User Agent\" strings:     $s = \"Mozillar/\"" +
                        " condition:     (uint16(0) == 0x5A4D and uint16(uint32(0x3c)) == 0x4550) and $s }");
        rssEntity.setOriginalMessage("Original release date: November 14, 2017 | Last revised: November 22, 2017<br />\n" +
                "\t\t<h3>Systems Affected</h3>\n" +
                "\t\t<p>Network systems</p>\t\t\n" +
                "\t\t<h3>Overview</h3>\n" +
                "\t\t<p>This joint Technical Alert (TA) is the result of analytic efforts between the Department of Homeland Security (DHS) and the Federal Bureau of Investigation (FBI). Working with U.S. government partners, DHS and FBI identified Internet Protocol (IP) addresses and other indicators of compromise (IOCs) associated with a Trojan malware variant used by the North Korean government—commonly known as Volgmer. The U.S. Government refers to malicious cyber activity by the North Korean government as HIDDEN COBRA. For more information on HIDDEN COBRA activity, visit <a href=\"https://www.us-cert.gov/hiddencobra\">https://www.us-cert.gov/hiddencobra</a>.</p><p>FBI has high confidence that HIDDEN COBRA actors are using the IP addresses—listed in this report’s IOC files—to maintain a presence on victims’ networks and to further network exploitation. DHS and FBI are distributing these IP addresses to enable network defense and reduce exposure to North Korean government malicious cyber activity.</p><p>This alert includes IOCs related to HIDDEN COBRA, IP addresses linked to systems infected with Volgmer malware, malware descriptions, and associated signatures. This alert also includes suggested response actions to the IOCs provided, recommended mitigation techniques, and information on reporting incidents. If users or administrators detect activity associated with the Volgmer malware, they should immediately flag it, report it to the DHS National Cybersecurity and Communications Integration Center (NCCIC) or the FBI Cyber Watch (CyWatch), and give it the highest priority for enhanced mitigation.</p><p>For a downloadable copy of IOCs, see:</p><ul><li>IOCs (<a href=\"https://www.us-cert.gov/sites/default/files/publications/TA-17-318B-IOCs.csv\">.csv</a>)</li><li>IOCs (<a href=\"https://www.us-cert.gov/sites/default/files/publications/TA-17-318B-IOCs.xml\">.stix</a>)</li></ul><p>NCCIC conducted analysis on five files associated with or identified as Volgmer malware and produced a Malware Analysis Report (MAR). MAR-10135536-D examines the tactics, techniques, and procedures observed. For a downloadable copy of the MAR, see:</p><ul><li>MAR (<a href=\"https://www.us-cert.gov/sites/default/files/publications/MAR-10135536-D_WHITE_S508C.PDF\">.pdf</a>)</li><li>MAR IOCs (<a href=\"https://www.us-cert.gov/sites/default/files/publications/MAR-10135536-D_WHITE_stix.xml\">.stix</a>)</li></ul>\t\t\n" +
                "\t\t<h3>Description</h3>\n" +
                "\t\t<p>Volgmer is a backdoor Trojan designed to provide covert access to a compromised system. Since at least 2013, HIDDEN COBRA actors have been observed using Volgmer malware in the wild to target the government, financial, automotive, and media industries.</p><p>It is suspected that spear phishing is the primary delivery mechanism for Volgmer infections; however, HIDDEN COBRA actors use a suite of custom tools, some of which could also be used to initially compromise a system. Therefore, it is possible that additional HIDDEN COBRA malware may be present on network infrastructure compromised with Volgmer</p><p>The U.S. Government has analyzed Volgmer’s infrastructure and have identified it on systems using both dynamic and static IP addresses. At least 94 static IP addresses were identified, as well as dynamic IP addresses registered across various countries. The greatest concentrations of dynamic IPs addresses are identified below by approximate percentage:</p><ul><li>India (772 IPs) 25.4 percent</li><li>Iran (373 IPs) 12.3 percent</li><li>Pakistan (343 IPs) 11.3 percent</li><li>Saudi Arabia (182 IPs) 6 percent</li><li>Taiwan (169 IPs) 5.6 percent</li><li>Thailand (140 IPs) 4.6 percent</li><li>Sri Lanka (121 IPs) 4 percent</li><li>China (82 IPs, including Hong Kong (12)) 2.7 percent</li><li>Vietnam (80 IPs) 2.6 percent</li><li>Indonesia (68 IPs) 2.2 percent</li><li>Russia (68 IPs) 2.2 percent</li></ul><h3><strong>Technical Details</strong></h3><p>As a backdoor Trojan, Volgmer has several capabilities including: gathering system information, updating service registry keys, downloading and uploading files, executing commands, terminating processes, and listing directories. In one of the samples received for analysis, the US-CERT Code Analysis Team observed botnet controller functionality.</p><p>Volgmer payloads have been observed in 32-bit form as either executables or dynamic-link library (.dll) files. The malware uses a custom binary protocol to beacon back to the command and control (C2) server, often via TCP port 8080 or 8088, with some payloads implementing Secure Socket Layer (SSL) encryption to obfuscate communications.</p><p>Malicious actors commonly maintain persistence on a victim’s system by installing the malware-as-a-service. Volgmer queries the system and randomly selects a service in which to install a copy of itself. The malware then overwrites the ServiceDLL entry in the selected service's registry entry. In some cases, HIDDEN COBRA actors give the created service a pseudo-random name that may be composed of various hardcoded words.</p><h3><strong>Detection and Response</strong></h3><p>This alert’s IOC files provide HIDDEN COBRA indicators related to Volgmer. DHS and FBI recommend that network administrators review the information provided, identify whether any of the provided IP addresses fall within their organizations’ allocated IP address space, and—if found—take necessary measures to remove the malware.</p><p>When reviewing network perimeter logs for the IP addresses, organizations may find instances of these IP addresses attempting to connect to their systems. Upon reviewing the traffic from these IP addresses, system owners may find some traffic relates to malicious activity and some traffic relates to legitimate activity.</p><h3>Network Signatures and Host-Based Rules</h3><p>This section contains network signatures and host-based rules that can be used to detect malicious activity associated with HIDDEN COBRA actors. Although created using a comprehensive vetting process, the possibility of false positives always remains. These signatures and rules should be used to supplement analysis and should not be used as a sole source of attributing this activity to HIDDEN COBRA actors.</p><h4>Network Signatures</h4><p><code>alert tcp any any -&#62; any any (msg:\"Malformed_UA\"; content:\"User-Agent: Mozillar/\"; depth:500; sid:99999999;)</code></p><p>___________________________________________________________________________________________________</p><h4>YARA Rules</h4><p><code>rule volgmer<br />{<br />meta:<br />    description = \"Malformed User Agent\"<br />strings:<br />    $s = \"Mozillar/\"<br />condition:<br />    (uint16(0) == 0x5A4D and uint16(uint32(0x3c)) == 0x4550) and $s<br />}</code></p>\t\t\n" +
                "\t\t<h3>Impact</h3>\n" +
                "\t\t<p>A successful network intrusion can have severe impacts, particularly if the compromise becomes public and sensitive information is exposed. Possible impacts include</p><ul><li>temporary or permanent loss of sensitive or proprietary information,</li><li>disruption to regular operations,</li><li>financial losses incurred to restore systems and files, and</li><li>potential harm to an organization’s reputation.</li></ul>\t\t\n" +
                "\t\t<h3>Solution</h3>\n" +
                "\t\t<h4><strong><em>Mitigation Strategies</em></strong></h4><p>DHS recommends that users and administrators use the following best practices as preventive measures to protect their computer networks:</p><ul><li>Use application whitelisting to help prevent malicious software and unapproved programs from running. Application whitelisting is one of the best security strategies as it allows only specified programs to run, while blocking all others, including malicious software.</li><li>Keep operating systems and software up-to-date with the latest patches. Vulnerable applications and operating systems are the target of most attacks. Patching with the latest updates greatly reduces the number of exploitable entry points available to an attacker.</li><li>Maintain up-to-date antivirus software, and scan all software downloaded from the Internet before executing.</li><li>Restrict users’ abilities (permissions) to install and run unwanted software applications, and apply the principle of “least privilege” to all systems and services. Restricting these privileges may prevent malware from running or limit its capability to spread through the network.</li><li>Avoid enabling macros from email attachments. If a user opens the attachment and enables macros, embedded code will execute the malware on the machine. For enterprises or organizations, it may be best to block email messages with attachments from suspicious sources. For information on safely handling email attachments, see <a href=\"https://www.us-cert.gov/sites/default/files/publications/emailscams_0905.pdf\">Recognizing and Avoiding Email Scams</a>. Follow safe practices when browsing the web. See <a href=\"https://www.us-cert.gov/ncas/tips/ST04-003\">Good Security Habits</a> and <a href=\"https://www.us-cert.gov/ncas/tips/ST06-008\">Safeguarding Your Data</a> for additional details.</li><li>Do not follow unsolicited web links in emails. See <a href=\"https://www.us-cert.gov/ncas/tips/ST04-014\">Avoiding Social Engineering and Phishing Attacks</a> for more information.</li></ul><h4><strong><em>Response to Unauthorized Network Access</em></strong></h4><ul><li><strong>Contact DHS or your local FBI office immediately.</strong> To report an intrusion and request resources for incident response or technical assistance, contact DHS NCCIC (<a href=\"https://www.us-cert.govmailto:NCCICCustomerService@hq.dhs.gov\">NCCICCustomerService@hq.dhs.gov</a> or 888-282-0870), FBI through a local field office, or the FBI’s Cyber Division (<a href=\"https://www.us-cert.govmailto:CyWatch@fbi.gov\">CyWatch@fbi.gov</a> or 855-292-3937).</li></ul>\t\t\n" +
                "\t\t<h3>References</h3>\n" +
                "\t\t<ul>\n" +
                "\t\t\t\t</ul>\n" +
                "\t\t\n" +
                "\t\t<h3>Revision History</h3>\n" +
                "\t\t<ul>\n" +
                "\t\t\t\t\t<li>November 14, 2017: Initial version</li>\n" +
                "\t\t\t\t\t</ul>\n" +
                "\t\t<hr />\n" +
                "\t\t<p>This product is provided subject to this <a href=\"http://www.us-cert.gov/privacy/notification\">Notification</a> and this <a href=\"http://www.us-cert.gov/privacy/\">Privacy &#38; Use</a> policy.</p>\t\t<br />\n" +
                "\t'}");
        rssEntity.setSource("From RSS");

        /* HTML */
        htmlEntity.setShortDescription("Information leak in kldstat(2)");
        htmlEntity.setLongDescription("CVE Name: CVE-2017-1088 For general information regarding FreeBSD" +
                " Security Advisories, including descriptions of the fields above, security branches, and the following sections," +
                " please visit . 0. Revision history v1.0 2017-11-15 Initial release. v1.1 2017-11-20 Corrected credit. Ilja van" +
                " Sprundel first reported the issue to the project, but wasn't cited. The FreeBSD Security Team apologizes to Ilja" +
                " for this oversight. I. Background The kldstat(2) syscall provides information about loaded kld files. The syscall" +
                " takes a userland argument of struct kld_file_stat which is then filled with data about the kld file requested. II." +
                " Problem Description The kernel does not properly clear the memory of the kld_file_stat structure before filling" +
                " the data. Since the structure filled by the kernel is allocated on the kernel stack and copied to userspace," +
                " a leak of information from the kernel stack is possible. III. Impact Some bytes from the kernel stack can be" +
                " observed in userspace. IV. Workaround No workaround is available. V. Solution Perform one of the following: 1)" +
                " Upgrade your vulnerable system to a supported FreeBSD stable or release / security branch (releng) dated after the" +
                " correction date. Afterward, reboot the system. 2) To update your vulnerable system via a binary patch: Systems" +
                " running a RELEASE version of FreeBSD on the i386 or amd64 platforms can be updated via the freebsd-update(8) " +
                "utility: # freebsd-update fetch # freebsd-update install Afterward, reboot the system. 3) To update your vulnerable " +
                "system via a source code patch: The following patches have been verified to apply to the applicable FreeBSD release" +
                " branches. a) Download the relevant patch from the location below, and verify the detached PGP signature using your " +
                "PGP utility. # fetch https://security.FreeBSD.org/patches/SA-17:10/kldstat.patch # " +
                "fetch https://security.FreeBSD.org/patches/SA-17:10/kldstat.patch.asc # gpg --verify kldstat.patch.asc" +
                " b) Apply the patch. Execute the following commands as root: # cd /usr/src # patch < /path/to/patch " +
                "c) Recompile your kernel as described in and reboot the system.");
        htmlEntity.setOriginalMessage("CVE Name: CVE-2017-1088" +
                " For general information regarding FreeBSD Security Advisories, including descriptions of the fields above," +
                " security branches, and the following sections, please visit . 0. Revision history v1.0 2017-11-15 Initial release." +
                " v1.1 2017-11-20 Corrected credit. Ilja van Sprundel first reported the issue to the project, but wasn't cited. The" +
                " FreeBSD Security Team apologizes to Ilja for this oversight. I. Background The kldstat(2) syscall provides" +
                        " information about loaded kld files. The syscall takes a userland argument of struct kld_file_stat which is " +
                        "then filled with data about the kld file requested. II. Problem Description The kernel does not properly " +
                        "clear the memory of the kld_file_stat structure before filling the data. Since the structure filled by the" +
                        " kernel is allocated on the kernel stack and copied to userspace, a leak of information from the kernel" +
                        " stack is possible. III. Impact Some bytes from the kernel stack can be observed in userspace. IV. Workaround No workaround is available. V. Solution Perform one of the following:" +
                        " 1) Upgrade your vulnerable system to a supported FreeBSD stable or release / security branch (releng) dated after the correction date. Afterward, reboot the system. 2) To update your vulnerable system via a binary patch: Systems running a RELEASE version of FreeBSD" +
                        " on the i386 or amd64 platforms can be updated via the freebsd-update(8) utility: # freebsd-update fetch # freebsd-update install Afterward, reboot the system. 3) To update your vulnerable system via a source code patch: The following patches have been verified to apply to the applicable FreeBSD release branches." +
                        " a) Download the relevant patch from the location below, and verify the detached PGP signature using your PGP utility. # fetch https://security.FreeBSD.org/patches/SA-17:10/kldstat.patch # fetch https://security.FreeBSD.org/patches/SA-17:10/kldstat.patch.asc # gpg --verify kldstat.patch.asc b) Apply the patch. Execute the following commands as root: # cd /usr/src # patch < /path/to/patch c) Recompile your kernel as described in and reboot the system.");
        htmlEntity.setSource("From HTML");

        emailEntityArrayList = new ArrayList<PreprocessingEntity>();
        rssEntityArrayList = new ArrayList<PreprocessingEntity>();
        htmlEntityArrayList = new ArrayList<PreprocessingEntity>();
        preprocessingEntities = new ArrayList<PreprocessingEntity>();

        emailEntityArrayList.add(emailEntity);
        rssEntityArrayList.add(rssEntity);
        htmlEntityArrayList.add(htmlEntity);

        preprocessingEntities.addAll(emailEntityArrayList);
        preprocessingEntities.addAll(rssEntityArrayList);
        preprocessingEntities.addAll(htmlEntityArrayList);

        preprocessing = new Preprocessing(preprocessingEntities);

        }
        @Test
        public void conductPreprocessing_AND_Classification() {

        preprocessing.conductPreprocessingStep();

        classification = new Classification(preprocessing.getPreprocessingEntities());
        classification.tfIdfClaculator_LONG();
        classification.getCosineSimilarity();

        }


}
