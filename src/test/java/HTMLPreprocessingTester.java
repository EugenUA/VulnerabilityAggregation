import entities.programEntities.HTMLAlert;
import org.junit.Before;
import org.junit.Test;
import service.vulnerabilities_aggregation.Preprocessing.CreatingEntities.HTMLPreprocessing;

import java.util.ArrayList;

public class HTMLPreprocessingTester {

    public HTMLAlert freeBsdAlert = new HTMLAlert();
    public HTMLAlert secuniaAlert = new HTMLAlert();

    @Before
    public void setUp() throws Exception{
        freeBsdAlert.setOrigin("FreeBSD");
        freeBsdAlert.setTitle("Information leak in kldstat(2)");
        freeBsdAlert.setLink("https://security.FreeBSD.org/advisories/FreeBSD-SA-17:10.kldstat.asc");
        freeBsdAlert.setDescription("CVE Name: CVE-2017-1088 For general information regarding FreeBSD Security Advisories, including descriptions of the fields above, security branches, and the following sections, please visit . 0. Revision history v1.0 2017-11-15 Initial release. v1.1 2017-11-20 Corrected credit. Ilja van Sprundel first reported the issue to the project, but wasn't cited. The FreeBSD Security Team apologizes to Ilja for this oversight. I. Background The kldstat(2) syscall provides information about loaded kld files. The syscall takes a userland argument of struct kld_file_stat which is then filled with data about the kld file requested. II. Problem Description The kernel does not properly clear the memory of the kld_file_stat structure before filling the data. Since the structure filled by the kernel is allocated on the kernel stack and copied to userspace, a leak of information from the kernel stack is possible. III. Impact Some bytes from the kernel stack can be observed in userspace. IV. Workaround No workaround is available. V. Solution Perform one of the following: 1) Upgrade your vulnerable system to a supported FreeBSD stable or release / security branch (releng) dated after the correction date. Afterward, reboot the system. 2) To update your vulnerable system via a binary patch: Systems running a RELEASE version of FreeBSD on the i386 or amd64 platforms can be updated via the freebsd-update(8) utility: # freebsd-update fetch # freebsd-update install Afterward, reboot the system. 3) To update your vulnerable system via a source code patch: The following patches have been verified to apply to the applicable FreeBSD release branches. a) Download the relevant patch from the location below, and verify the detached PGP signature using your PGP utility. # fetch https://security.FreeBSD.org/patches/SA-17:10/kldstat.patch # fetch https://security.FreeBSD.org/patches/SA-17:10/kldstat.patch.asc # gpg --verify kldstat.patch.asc b) Apply the patch. Execute the following commands as root: # cd /usr/src # patch < /path/to/patch c) Recompile your kernel as described in and reboot the system.");
        freeBsdAlert.setPubDate("2017-11-15");

        secuniaAlert.setOrigin("Secunia Research");
        secuniaAlert.setTitle("Oracle Outside In Denial of Service Vulnerability");
        secuniaAlert.setLink("https://secuniaresearch.flexerasoftware.com/secunia_research/2017-18/");
        secuniaAlert.setDescription("1) Affected Software\n" +
                "\n" +
                "* Oracle Outside In version 8.5.3.0.\n" +
                "\n" +
                "======================================================================\n" +
                "2) Severity\n" +
                "\n" +
                "Rating: Moderately critical\n" +
                "Impact: Denial of Service\n" +
                "Where:  From remote\n" +
                "\n" +
                "======================================================================\n" +
                "3) Description of Vulnerabilitiy\n" +
                "\n" +
                "Secunia Research has discovered a vulnerability in Oracle Outside In,\n" +
                "which can be exploited by malicious people to cause a DoS\n" +
                "(Denial of Service).\n" +
                "\n" +
                "The vulnerability is caused due to an error within the vstif6.dll,\n" +
                "which can be exploited to cause an out-of-bounds write memory access.\n" +
                "\n" +
                "The vulnerability is confirmed in version 8.5.3.\n" +
                "\n" +
                "======================================================================\n" +
                "4) Solution\n" +
                "\n" +
                "Apply update.\n" +
                "https://support.oracle.com/rs?type=doc&id=2296870.1\n" +
                "\n" +
                "======================================================================\n");
        secuniaAlert.setPubDate("2017/10/21");
    }

    @Test
    public void htmlPreprocessingTester(){
        ArrayList<HTMLAlert> htmlAlerts = new ArrayList<HTMLAlert>();
        htmlAlerts.add(freeBsdAlert);
        htmlAlerts.add(secuniaAlert);

        HTMLPreprocessing htmlPreprocessing = new HTMLPreprocessing(htmlAlerts);
        htmlPreprocessing.createHTMLPreprocessingEntities();
    }


}
